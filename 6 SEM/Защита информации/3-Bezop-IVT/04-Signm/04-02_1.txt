> # Демонстрация криптографического протокола электронной
> # подписи RSA с секретной передачей сообщения
> # *******************************************
> with(numtheory):
> # -----------------------------------------------------
> # Банкир выбирает два случайных простых числа p1 и p2 и
> # случайное целое число 0<S<phi(p1*p2), (S,phi(p1*p2))=1.
> # Ключи R и S являются открытыми ключами
> # --------------------------------------
> p1:=1942668892225729070919461906823518906642406839052139521251812409738904285205208498221;
> p2:=1989292945639146568621528992587283360401824603189390869761855907572637988050133502132777;
> R:=p1*p2; phBank:=(p1-1)*(p2-1);
> S:=123876132205208335762278423601; # igcd(S,phBank);
> # ----------------------------------------------------------
> # Вкладчик B1 выбирает два случайных простых числа p1 и q1 и
> # случайное целое число 0<s1<phi(q1*q2), (s1,phi(q1*q2))=1.
> # Ключи r1 и s1 являются открытыми ключами
> # ----------------------------------------------------------
> q1:=4171849679533027504677776769862406473833407270227837441302815640277772901915313574263597826351;
> q2:=266998379490113760299377713271194014325338065294581596243380200977777465722580068752870260867081;
> r1:=q1*q2; ph1:=(q1-1)*(q2-1);
> s1:=1786393878363164227858270210279; # igcd(s1,ph1);
> # --------------------------------------------------
> # Банкир вычисляет секретный ключ T
> # -----------------------------------------------------
> T:='T'; sols:=msolve(S*T=1,phBank); assign(sols); T:=T; 
> # -----------------------------------------------------
> # Вкладчик B1 вычисляет секретный ключ t1
> # ----------------------------------------------------------
> t1:='t1'; sols1:=msolve(s1*t1=1,ph1); assign(sols1); t1:=t1; 
> # ----------------------------------------------------------
> # Вкладчик даёт банкиру распоряжение m (важно, чтобы m<r1)
> # --------------------------------------------------------------
> m:=812341242521515435903200431245123343674951737516;  Log:=r1-R;
> # --------------------------------------------------------------
> # Распоряжение шифруется и дешифруется в зависимости от
> # выполнения условия r1<R
> # -----------------------
> if r1<R 
>    then m1:=m  &^ t1 mod r1;  m2:=m1 &^ S  mod R;
>         m3:=m2 &^ T  mod R;   m4:=m3 &^ s1 mod r1
>    else m1:=m  &^ S  mod R;   m2:=m1 &^ t1 mod r1;
>         m3:=m2 &^ s1 mod r1;  m4:=m3 &^ T  mod R
> fi;
19426688922257290709194619068235189066424068390521395212518124097389042852052\  08498221
19892929456391465686215289925872833604018246031893908697618559075726379880501\  33502132777
38645375230172583446953518909319873442989273297064349986572352514515191422895\  604246267862450330850017266508831324033343508204367865614099502786767768214\  04280671468710289717
38645375230172583446953518909319873442989273297064349986572352514515191422895\  604246247950094185536294289584346779092274715119697765329669409955690568390\  27388336129999658720
                       123876132205208335762278423601
41718496795330275046777767698624064738334072702278374413028156402777729019153\  13574263597826351
26699837949011376029937771327119401432533806529458159624338020097777746572258\  0068752870260867081
11138771039116687545510672865479226867415108660274804518015606733152527263693\  060025649201200314681825317028617289943692094366575499589847422324278412262\  32435332781707353985214366888130251431
11138771039116687545510672865479226867415108660274804518015606733152527263693\  060025649201200311970123025332149411903137193956011291598132696676184075415\  49418714726468729489832039754271558000
                       1786393878363164227858270210279
                                      T
{T = 230726595042411533980460039812836889993533377268207609168020100852629367\  124284848087897991782386868391546511979031816145699166271734056411976690385\  7227137940434810257460401}
23072659504241153398046003981283688999353337726820760916802010085262936712428\  484808789799178238686839154651197903181614569916627173405641197669038572271\  37940434810257460401
                                     t1
{t1 = 10905655025228916182926990204175343222472034155664378788024777350532831\  723572544893478202253631321430022366880579196823498845432389007257929419844\  63616233718226914091858983777397034416153319}
10905655025228916182926990204175343222472034155664378788024777350532831723572\  544893478202253631321430022366880579196823498845432389007257929419844636162\  33718226914091858983777397034416153319
              812341242521515435903200431245123343674951737516
11138771039116687506865297635306643420461589750954931075026333436088177277120\  707511134009777419077579049166166959093674827857744175556503914119910546648\  22485054104930532580933695419419961714
24851182277793781155165412752146432743771781289956323306606374961382685519788\  321752340522239308720880541903389204188789264793759203377062848511389751316\  23170385268669095130
73489742554402060454691702809631186932817767813057502440882016898115437295923\  732102259230052003988394875193680716353516685542790019691868043321139523645\  3568380666048559059355500695895883062
24851182277793781155165412752146432743771781289956323306606374961382685519788\  321752340522239308720880541903389204188789264793759203377062848511389751316\  23170385268669095130
              812341242521515435903200431245123343674951737516
> test := m-m4;
                                      0
