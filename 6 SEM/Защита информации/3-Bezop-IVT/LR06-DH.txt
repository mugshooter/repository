    2УПРАЖНЕНИЕ 6.
    2ЭЛЕМЕНТЫ КРИПТОГРАФИИ: система Диффи-Хеллмана, шифр Шамира, шифр
 2Эль-Гамаля, система Меркла-Хеллмана

 ш1.0
                  1Есть мистический смысл во  многих  жизнях,  но  не
                  1всеми  верно понимается.  Он даётся нам чаще в за-
                  1шифрованном виде, а мы, не расшифровав, отчаиваем-
                  1ся, как  бессмысленная  наша  жизнь. Успех великих
                  1жизней часто в том,  что человек расшифровал  спу-
                  1щенный ему шифр, понял и научился правильно идти.
                                                   1Вяч. Всев. Иванов
 ш1.2

                  2ОБЯЗАТЕЛЬНЫЕ РЕЗУЛЬТАТЫ ОБУЧЕНИЯ
    _ 1Основные понятия . 0:
 ш1.0
   -  1метод Диффи-Хеллмана для открытого распределения ключей 0;
    1- 0  1шифр Шамира 0;
    1- 0  1шифр Эль-Гамаля, 0  1вариант шифра Эль-Гамаля 0;
    1- 0  1система Меркла-Хеллмана 0;
    1- протокол "шарады Меркла" 0;
    1- 0  1гибридные криптосистемы 0.

    _ 1Уметь . 0:
    1- 0  1реализовать метод Диффи-Хеллмана для распределения ключей 0;
    1- 0  1реализовать шифр Шамира 0;
    1- 0  1реализовать шифр Эль-Гамаля 0;
    1- 0  1реализовать систему Меркла-Хеллмана 0.
 ш1.2

                       2ТЕОРЕТИЧЕСКИЕ СВЕДЕНИЯ
                 3Метод Диффи-Хеллмана для 0  3открытого
                        3распределения ключей

 ш1.0
                   1Более всего надо печься о том,  чтобы  ничего  не
                   1записывать,  но  всё познавать и усваивать 0: 1  ведь
                   1невозможно, чтобы написанное не получило огласки.
                   1Поэтому  я никогда ничего не писал о таких вещах,
                   1и на свете нет и не будет никакой Платоновой  за-
                   1писи 0;   1а то, что теперь читают, - это речи Сокра-
                   1та, когда он, ещё молодой, был прекрасен. 0
                                                   1Платон. Письмо II
 ш1.2

    1У.Диффи 0 и  1М.Хеллман 0 ( 1W.Diffi 0,  1M.Hellman 0, 1976) предложили  новый
метод, который состоит в использовании  _ 1открытого распределения клю-
 _ 1чей . 0.
    3Замечание 0 ( 1с точки зрения истории криптографии 0)
             (по [Сингх,2007,с.314-328]).
 ш1.1
   Часто говорят,  что этот способ обмена ключами  является   1первой
 1криптосистемой с открытым ключом 0.
   Однако метод был получен  _ 1Малькольмом Уильямсоном . 0 (1974),  но его
открытие было засекречено,  т.к.  он работал в  1Штаб-квартире прави-
 1тельственной связи 0 (Великобритания,  Челтенхем) -  спецслужбе,  от-
ветственной за разведку средств связи.

 ш1.2
   У.Диффи и М.Хеллман задались вопросом: можно ли организовать та-
кую  процедуру  взаимодействия  абонентов A и B по открытым каналам
связи, чтобы решить следующие задачи:
 ш1.1
   (1) вначале у абонентов A и B нет никакой общей секретной инфор-
мации, но в конце процедуры такая общая секретная информация ( _ 1общий
 _ 1ключ . 0) у A и B появляется (другими словами, " 1вырабатывается 0");
   (2) противник, знающий метод шифрования  и  перехватывающий  все
передачи информации,  тем не менее не может восстановить выработан-
ный общий ключ абонентов A и B.

 ш1.2
   Синтаксическое представление ключа, вообще говоря, не имеет зна-
чения (например, ключ представляет собой  1цепочку битов 0).
    2Определение 0 (по [Введение,2012,с.308,310,335]).
 ш1.1
    2(1) 0  _ 1Аутентифицированный канал связи . 0 - это канал связи, обеспечи-
вающий  1целостность 0 передаваемой по нему информации.
    2(2) 0  _ 1Целостность . 0 ( 1в криптографии 0) - это гарантия того, что в про-
цессе выполнения протокола не было вмешательства  1активного  против-
 1ника 0, повлекшего  за собой нежелательные для данного участника пос-
ледствия.
    2(3) 0  _ 1Протокол Диффи-Хеллмана . 0 - протокол выработки общего  секрет-
ного  ключа двумя участниками,  которые не имеют изначально никакой
общей секретной информации и обмениваются сообщениями по  не  защи-
щённому от подслушивания, но  1аутентифицированному каналу связи 0.

 ш1.2
    2Определение 0 [Введение,2012,с.309] ( 1повторение 0).
 ш1.1
    _ 1Алиса . 0 и  _ 1Боб . 0 - это типичные имена участников, принятые для описа-
ния криптографических  протоколов в работах по  1математической крип-
 1тографии 0.
   В случае  криптосистем противник обычно выступает под именем  _ 1Ева
(англ.  3e 1avesdropper 0 - подслушивающий), реже - под каким-либо другим
именем (но практически всегда под женским).
   В криптографии  имена участников обычно берутся в алфавитном по-
рядке.
   Итак, рассматривая проблему распределения ключей, полезно предс-
тавить себе Алису, Боба и Еву, трёх вымышленных лиц, являющихся на-
рицательными персонажами при обсуждении вопросов криптографии.

 ш1.2
   Алиса и Боб хотят просто обменяться ключами, чтобы в будущем су-
меть зашифровать и расшифровать сообщение.
   Для получения общего ключа они обмениваются несколькими  сообще-
ниями - сообщениями открытого текста, в которых нет никакого ключа,
нужного обеим сторонам;  однако после завершения обмена сообщениями
у Алисы и Боба уже имеется общий ключ,  т.е.  получается, что никто
никому ключ не посылал (!), и, следовательно, неясно как его перех-
ватить.
   Приведём  _ 1протокол Диффи-Хеллмана . 0.

    21. 0 Вначале Алиса и Боб встречаются и выбирают:
 ш1.1
   (1)  1большое 0 (!) простое число p;
   (2) натуральное число g,  2 7, 0g 7, 0p-2,  такое, что все числа из мно-
жества  {1,2,...,p-1} могут быть представлены как  _ 1различные . 0 степени
g по модулю p (другими словами,  g является примитивным элементом в
GF(p)).

 ш1.2
   Числа p и g  _ 1открыты . 0, т.е. не являются секретными.
    22. 0 Алиса выбирает большое  _ 1секретное . 0 число a, 1 7, 0a 7, 0p-1.
    23. 0 Боб выбирает большое  _ 1секретное . 0 число b, 1 7, 0b 7, 0p-1.
    24.  0Алиса независимо от Боба вычисляет свой  _ 1открытый ключ
 ш1.0

   A  ═+ 0 g 5a 0  1mod 0 p

 ш1.2
и посылает его Бобу.
    24.  0Боб независимо от Алисы вычисляет свой  _ 1открытый ключ
 ш1.0

   B  ═+ 0 g 5b 0  1mod 0 p

 ш1.2
и посылает его Алисе.
    25. 0 Алиса независимо от Боба вычисляет их общий (!) ключ
 ш1.0

   k 41 0  ═+ 0 B 5a 0  1mod 0 p.

 ш1.2
    26. 0 Боб независимо от Алисы вычисляет их общий (!) ключ
 ш1.0

   k 42 0  ═+ 0 A 5b 0  1mod 0 p.

 ш1.2
   "Внезапно" оказывается, что справедливо следующее утверждение.
    2Теорема 0 ( 1важная 0).
 ш1.1
   "Обмен" ключами выполнен, т.е.
 ш1.0

   k 41 0=k 42 0 => B 5a 0  1mod 0 p=A 5b 0  1mod 0 p.

 ш1.2
    2Доказательство 0. В самом деле,
 ш1.0

   B 5a 0  1mod 0 p=(g 5b 0  1mod 0 p) 5a 0  1mod 0 p=(g 5b 0) 5a 0  1mod 0 p=g 5ba 0  1mod 0 p,

   A 5b 0  1mod 0 p=(g 5a 0  1mod 0 p) 5b 0  1mod 0 p=(g 5a 0) 5b 0  1mod 0 p=g 5ab 0  1mod 0 p.

 ш1.2
    1Теорема доказана 0.
    3Замечание 0 ( 1важное 0).
 ш1.1
   Для выбора g рекомендуется использовать следующий приём.
   Простое число p выбирается таким, чтобы выполнялось равенство
 ш1.0

   p=2 77 0q+1,

 ш1.2
где q - простое число.
   Тогда в качестве g можно взять любое натуральное число, для  ко-
торого справедливы неравенства
 ш1.0

   1<g<p-1, g 5q 1 mod 0 p 7- 01.

 ш1.2
    2Пример 0 [Рябко,Фионов,2018,с.19-20].
 ш1.1
   Пусть p=23=2 77 011+1, q=11. Выберем параметр g; начнём с g=3:
 ш1.0

   3 511 1 mod 0 23=1     ( 1не подходит, поэтому продолжим... 0)
   5 511 1 mod 0 23=22 7- 01 1  0 ( 1подходит 0) 1.

 ш1.1
   Итак, выбраны параметры p=23, g=5. Теперь каждый абонент выбира-
ет закрытый ключ и вычисляет соответствующий ему открытый ключ.
   Пусть выбраны a=7, b=13. Вычисляем
 ш1.0

   A=5 57 0  1mod 0 23=17, B=5 513 0  1mod 0 23=21.

 ш1.1
   Алиса и Боб решили сформировать общий секретный ключ.
   Для этого Алиса вычисляет k 41 0=21 57 0  1mod 0 23=10, а Боб вычисляет
 ш1.0

   k 42 0=17 513 0  1mod 0 23=10.

 ш1.1
   Итак, они имеют  _ 1общий . 0 (!) ключ 10, который, тем не менее, не пе-
редавался по каналу связи.

 ш1.2
    3Замечания 0 ( 1важные 0).
 ш1.1
    21. 0 Алгоритм, разработанный для  _ 1квантовых компьютеров . 0, решает за-
дачу дискретного логарифма за полиномиальное время,  т.е. если  по-
явятся квантовые компьютеры, то метод Диффи-Хеллмана окажется прак-
тически бесполезным.
    22. 0 Срок действия патента этого метода  1истёк 0 29 апреля 1997 года.
 ш1.2

                             2Шифр Шамира

 ш1.0
                  1- Ключ 0! 1 - воскликнул Бильбо. - Ключ 0! 1 Где Торин 0?
                  1Гном подбежал к хоббиту.
                  1- С картой Гэндальф отдал вам ключ. Попробуйте его
                  1вставить 0! 1 Только поскорее, не то будет поздно 0!
                  1Торин снял с шеи цепочку с ключом,  вставил ключ в
                  1замочную скважину, повернул 0: 1 Щёлк 0!
                              1Дж. Толкин. Хоббит, или Туда и Обратно
 ш1.2

   Этот шифр, предложенный Шамиром ( 1Adi Shamir 0), был первым, позво-
ляющим организовывать обмен секретными сообщениями по открытой  ли-
нии  связи  для лиц,  которые не имеют никаких защищённых каналов и
секретных ключей и, возможно, никогда не видели друг друга.
    3Замечание 0.
 ш1.1
   Напомним, что   система  Диффи-Хеллмана  позволяет  сформировать
только секретное слово,  а передача сообщения потребует использова-
ния некоторого шифра, где это слово будет использоваться как ключ.

 ш1.2
                       21. 3 Основные определения
   Перейдём к описанию системы.
   Пусть есть два абонента A и B, соединённые линией связи, и A хо-
чет передать сообщение m абоненту B так,  чтобы никто не узнал  его
содержание.
   Абонент A  выбирает  случайное большое простое число p и открыто
передаёт его B. Затем A выбирает два числа c 4A 0 и d 4A 0, такие что
 ш1.0

   c 4A 77 0d 4A 0  1mod 0 (p-1)=1.

 ш1.2
   Эти числа A являются закрытыми и передаваться не будут.
   B также выбирает два закрытых числа c 4B 0 и d 4B 0, такие что
 ш1.0

   c 4B 77 0d 4B 0  1mod 0 (p-1)=1.

 ш1.2
   После этого A передаёт своё сообщение m, используя трёхступенча-
тый протокол.
   Если m<p (m рассматривается как число),  то сообщение  передаёт-
ся сразу, если же m 7. 0p, то сообщение представляется в виде
 ш1.0

   m 41 0,m 42 0,...,m 4t 0, m 4i 0<p, i=1,2,...,t,

 ш1.2
и затем передаётся последовательно m 41 0, m 42 0,..., m 4t 0.
   При этом для кодирования каждого m 4i 0 лучше выбирать случайно  но-
вые пары  (c 4A 0,d 4A 0) и (c 4B 0,d 4B 0) - в противном случае надёжность системы
понижается.
   В настоящее время такой шифр,  как правило, используется для пе-
редачи чисел, например, закрытых ключей, значения которых меньше p.
   Таким образом, мы будем рассматривать только случай m<p.
   Приведём описание  _ 1протокола . 0 [Рябко,Фионов,2018,с.28-29].
   Обозначим m - исходное сообщение.
    _Шаг . 1. Абонент A вычисляет число
 ш1.0
        4c
   x 41 0=m  5A 0  1mod 0 p

 ш1.2
и пересылает x 41 0 абоненту B.
    _Шаг . 2. Абонент B, получив x 41 0, вычисляет число
 ш1.0
         4c
   x 42 0=x 41 0  5B 0  1mod 0 p

 ш1.2
и передаёт x 42 0 абоненту A.
    _Шаг . 3. Абонент A вычисляет число
 ш1.0
         4d
   x 43 0=x 42 0  5A 0  1mod 0 p

 ш1.2
и пересылает x 43 0 абоненту B.
    _Шаг . 4. Абонент B, получив x 43 0, вычисляет число
 ш1.0
         4d
   x 44 0=x 43 0  5B 0  1mod 0 p.

 ш1.2
    2Теорема 0 ( 1свойство протокола Шамира 0)
           (по [Рябко,Фионов,2018,с.29]).
 ш1.1
   В результате реализации протокола от A к B действительно переда-
ётся исходное сообщение, т.е. x 44 0=m.

 ш1.2
    2Доказательство 0. Вначале заметим, что любое целое число e 7. 00 может
быть представлено в виде e=k 77 0(p-1)+r, где r=e 1 mod 0 (p-1).
   Поэтому на основе малой теоремы Ферма
 ш1.0

   x 5e 1 mod 0 p = x 5k(p-1)+r 0  1mod 0 p = (1 5k 77 0x 5r 0)  1mod 0 p = x 5e mod (p-1) 0  1mod 0 p.

 ш1.2
   Остаётся записать следующую цепочку равенств:
 ш1.0
         4d 0           4┌ 0   4d 0  4┐d 0           4┌ 0   4c 0  4┐d 0  4d
   x 44 0=x 43 0  5B 0  1mod 0 p = │x 42 0  5A 0│  5B 0  1mod 0 p = │x 41 0  5B 0│  5A 0  5B 0  1mod 0 p =
                    4└ 0     4┘ 0            4└ 0     4┘
        4┌ 0  4c 0  4┐c 0  4d 0  4d 0            4c 0  4c 0  4d 0  4d
     = │m 5 A 0│  5B 0  5A 0  5B 0  1mod 0 p = m 5 A 0  5B 0  5A 0  5B 0  1mod 0 p =
        4└ 0    4┘
        4(c 0  4c 0  4d 0  4d ) mod (p-1) 0           4(c 0  4d 0  4)(c 0  4d ) mod (p-1)
     =m 5  0  5A 0  5B 0  5A 0  5B 0             1mod 0 p = m 5  0  5A 0  5A 0    5B 0  5B 0             1mod 0 p =
        7( 0                                     7)
     =  7* 0c 4A 77 0d 4A 0  1mod 0 (p-1)=1, c 4B 77 0d 4B 0  1mod 0 (p-1)=1 78 0=m.
        79 0                                     70

 ш1.2
    1Теорема доказана 0.
   Напомним метод нахождения пар (c 4A 0,d 4A 0) и (c 4B 0,d 4B 0), удовлетворяющих
c 4A 77 0d 4A 0  1mod 0 (p-1)=1, c 4B 77 0d 4B 0  1mod 0 (p-1)=1.
   Достаточно описать только действия для абонента A, т.к. действия
для B совершенно аналогичны.
   Число c 4A 0 выбираем случайно так, чтобы оно было взаимно простым с
(p-1) (поиск целесообразно вести среди  нечётных  чисел,  т.к.  p-1
чётно). Затем вычисляем d 4A 0 с помощью  _ 1обобщённого алгоритма Евклида . 0.
    2Пример 0.
 ш1.1
   Пусть A хочет передать B сообщение m=10.
   Абонент A выбирает p=23, c 4A 0=7 ( 1gcd 0(7,22)=1) и вычисляет d 4A 0=19.
   Аналогично, абонент B выбирает параметры c 4B 0=5 (взаимно простое с
22) и d 4B 0=9.
   Переходим к выполнению протокола Шамира.

    _Шаг . 1. x 41 0=10 57 1  0  1mod 0 23 = 14.
    _Шаг . 2. x 42 0=14 55 1  0  1mod 0 23 = 15.
    _Шаг . 3. x 43 0=15 519 1 mod 0 23 = 19.
    _Шаг . 4. x 44 0=19 59 1  0  1mod 0 23 = 10.

   Таким образом, B получил передаваемое сообщение m=10.

 ш1.2
    3Замечание 0 ( 1важное 0).
 ш1.1
   Недостатком шифра Шамира является то, что сообщение пересылается
три раза от одного абонента к другому, но этот шифр полностью реша-
ет задачу обмена сообщениями,  закрытыми для  прочтения  в  случае,
когда абоненты могут пользоваться только открытыми линиями связи.
   Далее мы увидим, что  _ 1шифр Эль-Гамаля . 0 позволяет решить  ту же за-
дачу за одну пересылку данных, но объём передаваемого шифротекста в
два раза превышает объём сообщения.
   Напомним, что  _ 1протокол RSA . 0 лишён подобных недостатков.
 ш1.2

                           2Шифр Эль-Гамаля

 ш1.0
                  1- Кроме того, - продолжал Гэндальф, - я забыл упо-
                  1мянуть о ключе, который прилагается к карте. Такой
                  1маленький, но весьма любопытный ключик. Вот он. 0
                  1Маг протянул  Торину серебряный ключ с причудливой
                  1бородкой. 0
                  1- Храни его как зеницу ока.
                  1- Разумеется. - Торин повесил ключ  на  цепочку  и
                  1спрятал под куртку. 0
                              1Дж. Толкин. Хоббит, или Туда и Обратно
 ш1.2

                        21. 3 Основной алгоритм
   Пусть имеются абоненты A, B, C,.., которые хотят передавать друг
другу зашифрованные сообщения,  не имея никаких защищённых  каналов
связи.
   Рассмотрим шифр, предложенный Т.Эль-Гамалем ( 1Taher ElGamal 0, США,
1985), который решает эту задачу, используя, в отличие от шифра Ша-
мира, только одну пересылку сообщения. Фактически здесь использует-
ся схема Диффи-Хеллмана для того, чтобы сформировать общий закрытый
ключ для двух абонентов,  передающих друг другу сообщение,  и затем
сообщение шифруется путём умножения на этот ключ.
   Для каждого следующего сообщения закрытый ключ вычисляется зано-
во. Перейдём к точному описанию метода Эль-Гамаля.
   Для всей группы абонентов выбираются некоторое  большое  простое
число p  и  число  g такие,  что различные степени g суть различные
числа по модулю p (см.  1метод Диффи-Хеллмана 0).
   Числа p  и g передаются абонентам в открытом виде (они могут ис-
пользоваться всеми абонентами сети).
   Затем каждый  абонент  группы  выбирает своё секретное число c 4i 0,
1<c 4i 0<p-1, и вычисляет соответствующий  _ 1открытый ключ
 ш1.0

       c 4i
   d 4i 0=g 7  0  1mod 0 p.

 ш1.2
   В результате получим следующую таблицу:
 ш1.0

   ┌───────┬────────┬────────┐
   │ 3Абонент 0│ 3Закрытый 0│ 3Открытый 0│
   │       │   3ключ 0  │   3ключ 0  │
   ╞═══════╪════════╪════════╡
   │   A   │   c 4A 0   │   d 4A 0   │
   │   B   │   c 4B 0   │   d 4B 0   │
   │   C   │   c 4C 0   │   d 4C 0   │
   └───────┴────────┴────────┘

 ш1.2
   Покажем теперь, как A передаёт абоненту B 1  0сообщение m.
   Будем предполагать, что сообщение представлено в виде числа m<p.
    _ 1Шаг . 0 1. Абонент A формирует случайное число k, 1 7, 0k 7, 0p-2, и  вычис-
ляет числа
 ш1.0

   r= g 5k 1 mod 0 p,  e= m 77 0d 4B 5k 0  1mod 0 p

 ш1.2
и пересылает пару (r,e) абоненту B.
    _ 1Шаг . 0 2. Абонент B, получив (r,e), вычисляет
 ш1.0

          p-1-c 4B
   m'= e 77 0r       4  1mod 0 p 4.

 ш1.2
    2Теорема 0 (по [Рябко,Фионов,2018,с.31-32]).
 ш1.1
    2(1) 0 Абонент B получил сообщение, т.е. m'=m.
    2(2) 0 Злоумышленник Ева, даже зная p, g, d 4B 0, r, e, не может  _ 1эффек-
 _ 1тивно . 0 вычислить m.

 ш1.2
    2Доказательство 0.
    21. 0 Выполним последовательные подстановки, а в конце воспользуем-
ся  1малой теоремой Ферма 0:
 ш1.0

          p-1-c 4B 0           4┌ 0 c 4B 0      4┐ 0                   p-1-c 4B
   m'= e 77 0r       4  1mod 0 p= m 77 0│g 7  0  1mod 0 p│ 5k 0  1mod 0 p  77 0(g 5k 1 mod 0 p)      =
                           4└ 0         4┘
          c 4B 0k  k(p-1-c 4B 0)
     = m 77 0g 7  0   77 0g  1  0        1mod 0 p= m 77 0g 5k(p-1) 0  1mod 0 p= m 77 01 5k 0  1mod 0 p= m.

 ш1.2
    22. 0 Ева не может вычислить k в равенстве r=g 5k 1 mod 0 p, т.к. это  _ 1за-
 _ 1дача дискретного логарифмирования . 0 (напомним,  что возводить число в
степень в конечном поле достаточно легко, однако восстановить аргу-
мент по значению, т.е. найти логарифм, очень трудно).
   Следовательно, она не может вычислить m в равенстве
 ш1.0

   e= m 77 0d 4B 5k 0  1mod 0 p,

 ш1.2
т.к. m было умножено на неизвестное ему число.
   Ева также не может воспроизвести действия абонента B,  т.к.  Еве
не известно закрытое число c 4B 0; его вычисление из уравнения
 ш1.0

        c 4B
   d 4B 0= g 7  0  1mod 0 p

 ш1.2
также является  _ 1задачей дискретного логарифмирования . 0.
    1Теорема доказана 0.
    2Пример 0 [Рябко,Фионов,2018,с.32].
 ш1.1
   Передадим сообщение  _m=15 . от A к B. Выберем параметры p=23, g=5.
   Пусть абонент B выбрал для себя закрытый ключ c 4B 0=13 и вычислил
 ш1.0

   d 4B 0= 5 513 1 mod 0 23=21.

 ш1.1
   Абонент A выбирает случайное число, например, k=7 и вычисляет
 ш1.0

   r= 5 57 1 mod 0 23=17, e= 15 77 021 57 0  1mod 0 23= 15 77 010  1mod 0 23= 12.

 ш1.1
   Теперь A посылает B зашифрованное сообщение в виде пары (17,12).
   Абонент B вычисляет
 ш1.0

   m'= 12 77 017 523-1-13 0  1mod 0 23= 12 77 017 59 0  1mod 0 23= 12 77 07  1mod 0 23=  _15 ..

   Итак, абонент B расшифровал переданное сообщение.

 ш1.2
   По аналогичной схеме могут передавать сообщения все  абоненты  в
сети. Заметим, что любой абонент, знающий открытый ключ абонента B,
может посылать ему сообщения,  зашифрованные  с  помощью  открытого
ключа d 4B 0.  но только абонент B,  и никто другой, может расшифровать
эти сообщения, используя известный только ему закрытый ключ c 4B 0.
    3Замечания 0 ( 1важные 0).
 ш1.1
    21. 0 Объём шифра  _ 1в два раза превышает . 0 объём сообщения, но требует-
ся только одна передача данных (при условии, что таблица с открыты-
ми ключами заранее известна всем абонентам).
    22. 0 При использовании метода Эль-Гамаля с модулем p, состоящим из
150 знаков, достигается та же степень защиты, что для алгоритма RSA
с модулем из 200 знаков.
   Это позволяет в 5-7 раз увеличить скорость обработки информации.
   Однако в таком варианте открытого шифрования  нет  подтверждения
подлинности сообщений.
    23. 0 Криптоалгоритм не запатентован, но попадал под  действие  па-
тента на метод Диффи-Хеллмана.

 ш1.2
                     22. 0  3Вариант 0  3шифра 0  3Эль-Гамаля
   Приведём вариант схемы,  когда умножение по модулю p  заменяется
на операцию  7Х 0.
   Однако при этом придётся разбивать передаваемый текст  на  блоки
той же длины, что и число (y 5k 0  1mod 0 p).
   В случае  использования  операции  " 1умножение по модулю p 0" можно
обрабатывать блоки  текста  заранее  заданной  фиксированной  длины
меньшей, чем число p.
   Вспомним, что Алиса, Боб и Ева являются классическими персонажа-
ми криптографических протоколов при описании сеанса передачи инфор-
мации между Алисой и Бобом.
   Рассмотрим  _ 1вариант протокола Эль-Гамаля . 0.
   Пусть Алиса хочет послать Бобу сообщение m.
    21.  0Алиса  и Боб совместно выбирают простое число p и целое число
g (эти числа являются  _ 1открытыми . 0).
    22. 0 Алиса выбирает случайное число c 4A 0<p, которое является её  _ 1зак-
 _ 1рытым ключом . 0, и вычисляет:
 ш1.0

        c 4A 0              c 4A
   y 41 0= g 7  0  1mod 0 p, y 42 0= m 7Х 0y 7   0,

 ш1.2
где  7Х 0 - побитовое сложение по модулю 2.
   Затем Алиса посылает Бобу пару (y 41 0,y 42 0).
    23. 0 Боб  генерирует  случайное  число c 4B 0<p, которое является  его
 _ 1закрытым ключом . 0, и вычисляет  _ 1открытый ключ
 ш1.0

       c 4B
   y= g 7  0  1mod 0 p.

 ш1.2
    24. 0 Наконец, Боб, получив пару (y 41 0,y 42 0), восстанавливает сообщение:
 ш1.0

               c 4B 0                                         -c 4B
   m'= y 42 0  7Х 0 (y 41 0  7  1mod 0 p).                         ║ m= y 42 77 0y 41 7  0  1mod 0 p

 ш1.2
    2Теорема 0.
 ш1.1
   Боб получил сообщение, т.е. m'=m.

 ш1.2
    2Доказательство 0. Воспользуемся тем, что x 7Х 0x=0 и вычислим:
 ш1.0

               c 4B 0             4┌ 0 c 4B 0      4┐ 0c 4A 0   4┌ 0 c 4A 0      4┐ 0c 4B
   m'= y 42 0  7Х 0 (y 41 0  7  1mod 0 p)= m  7Х 0 │g 7  0  1mod 0 p│   7Х 0 │g 7  0  1mod 0 p│  7  1mod 0 p=
                              4└ 0         4┘ 0     4└ 0         4┘
                              4┌ 0 c 4B 0c 4A 0      4┐ 0    4┌ 0 c 4A 0c 4B 0      4┐
                       = m  7Х 0 │g 7  0    1mod 0 p│  7Х 0 │g 7  0   7  1mod 0 p│= m 7Х 00= m.
                              4└ 0           4┘ 0    4└ 0           4┘
 ш1.2
    1Теорема доказана 0.
    2Пример 0.
 ш1.1
   Пусть Алиса и Боб решили установить между собой скрытую связь  с
открытым ключом на базе алгоритма Эль-Гамаля.
   Алиса выбрала простое число р= 1125899906842679 и целое число
 ш1.0

   g= 745819352812378.

 ш1.1
   Затем Алиса генерирует закрытый ключ c 4A 0=725391906243661 и вычис-
ляет открытый ключ
 ш1.0

        c 4A
   y 41 0= g    1mod 0 p = 745819352812378 5725391906243661
                          1mod 0 1125899906842679= 1124568734648807
     
 ш1.1
и передает числа p, g, y 41 0 в открытый канал.
   Пусть Боб хочет послать Алисе сообщение m=4567345.
   Он выбирает случайное число c 4B 0=51394216073587<p и вычисляет:
 ш1.0

        c 4B 0                                 c 4B
   y 41 0= g   1mod 0 p= 440797012227888, y 42 0= m  7Х 0 y  = 380488283459650.

 ш1.1
и посылает Алисе пару (y 41 0, y 42 0).
   Алиса, получив зашифрованное сообщение, восстанавливает его:
 ш1.0

         c 4A
   m= (y 41 0   1mod 0 p)  7Х 0 y 42 0=
   
       = (440797012227888 5725391906243661 0  1mod 0 1125899906842679
                7Х 0 380488283459650)=
       = 380488279630195  7Х 0 380488283459650= 4567345.
 ш1.2

                       3Система Меркла-Хеллмана

 ш1.0
                                   1Всякая старина свою плешь хвалит.
                                                            1В.И.Даль
 ш1.2

   Эта система шифрования  иногда  называется   _ 1рюкз 3а 1ковой  системой
(одноимённая задача  из теории чисел называется  1задачей об упаковке
 1ранца 0).
   Пусть задано  множество целых чисел A  ═+ 0 {a 41 0,a 42 0,...,a 4n 0} и некото-
рое целое число C.
   Необходимо найти такое подмножество элементов A,  чтобы их сумма
была равна C,  т.е.  необходимо  сформировать  такой  булев  вектор
M  ═+ 0 (m 41 0,m 42 0,...,m 4n 0), что
 ш1.0

   C=a 41 77 0m 41 0+a 42 77 0m 42 0+ 7777 0+a 4n 77 0m 4n 0.

 ш1.2
   Например, пусть A  ═+ 0 {7,10,12,25,38,46}, C  ═+ 0 73. Тогда
 ш1.0

   M=(0,1,0,1,1,0), C=10+25+38.

 ш1.2
   Поиск вектора M относится к классу сложных задач.
   Тем не менее,  существует класс таких задач,  который называется
" 1укаладкой простого  рюкзака 0".  В  "простом рюкзаке" последователь-
ность (a 41 0,a 42 0,...,a 4n 0) является возрастающей, т.е. для любого элемен-
та множества выполняется соотношение
 ш1.0

   a 4i 0>a 41 0+a 42 0+ 7777 0+a 4i-1 0, i=2,3,...,n.

 ш1.2
   Например, A  ═+ 0 {1,3,8,14,29} является простым рюкзаком.
   В этой  постановке  задача нахождения вектора M  ═+ 0 (m 41 0,m 42 0,...,m 4n 0)
решается просто. Для формирования M достаточно использовать следую-
щую функцию на языке программирования Pascal:
 ш1.0

   const N=5; {Длина вектора M и количество элементов в A}
   type Vect: Array [1..N] of Integer;
   const A: Vect={1,3,8,14,29} {Инициализация множества A}
   { --------------------------------------------------- }
   Function KnapSack (C: Integer; Var M: Vect): Boolean;
      var i: Integer;
   Begin
      For i:=1 to N do M[i]:=0;
      For i:=N downto 1 do
        If C>=A[i]
          then begin M[i]:=1; C:=C-A[i] end;
      KnapSack:=C=0
   End;

 ш1.2
   Функция KnapSack возвращает TRUE,  если для числа  C  существует
разложение  по  вектору A (в этом случае в M возвращается найденное
разложение) и значение FALSE, если разложение найти не удалось.
   Например, если  C окажется больше суммы всех элементов множества
A, то построить вектор M не удастся.
   Р.Меркль и М.Хеллман предложили криптографическую систему с отк-
рытым ключом, основанную на задаче об укладке простого рюкзака.
   Приведём  _ 1протокол системы Меркла-Хеллмана . 0.
   Каждый из абонентов системы:
 ш1.1
   (1) выбирает  _ 1неубывающую . 0 последовательность A  ═+ 0 {a 41 0,a 42 0,...,a 4n 0};
   (2) выбирает целое число u, удовлетворяющее условию
 ш1.0

   u>a 41 0+a 42 0+ 7777 0+a 4n 0;

 ш1.1
   (3) выбирает целое число w такое, что (u,w)=1, а затем вычисляет
число w 5-1 0 (напомним, что w 77 0w 5-1 1 mod 0 u=1);
   (4) преобразует A в B  ═+ 0 {b 41 0,b 42 0,...,b 4n 0} по правилу
 ш1.0

   b 4i 0  ═+ 0 w 77 0a 4i 1 mod 0 u;

 ш1.1
   (5) последовательность  B  является  _ 1открытым ключом . 0 (для данного
абонента), а кортеж  ═< 0A,w 5-1 0,u ═> 0 -  _ 1закрытым ключом . 0 (этого абонента).

 ш1.2
   Пусть Алиса хочет послать n-битовое сообщение M  ═+ 0 (m 41 0,m 42 0,...,m 4n 0)
Бобу, объявившему открытый ключ B.
   Для этого Алиса вычисляет
 ш1.0

   C=m 41 77 0b 41 0+m 42 77 0b 42 0+ 7777 0+m 4n 77 0b 4n

 ш1.2
и посылает его Бобу.
   Боб, получив C, вычисляет:
 ш1.0

   w 5-1 77 0C=w 5-1 77 0(m 41 77 0b 41 0 + m 42 77 0b 42 0 + 7777 0+ m 4n 77 0b 4n 0)=

        = m 41 77 0w 5-1 77 0b 41 0 + m 42 77 0w 5-1 77 0b 42 0+ 7777 0+m 4n 77 0w 5-1 77 0b 4n 0={w 5-1 0b 4i 0=a 4i 1 mod 0 u} =

        = (m 41 77 0a 41 0+m 42 77 0a 42 0+ 7777 0+m 4n 77 0a 4n 0) 1 mod 0 u.

 ш1.2
   Другими словами, m 41 77 0a 41 0+m 42 77 0a 42 0+ 7777 0+m 4n 77 0a 4n 0=w 5-1 77 0C  1mod 0 u.
   Поскольку последовательность A  ═+ 0 {a 41 0,a 42 0,...,a 4n 0} возрастающая, то
Боб применяет  функцию KnapSack() для восстановления сообщения M из
числа w 5-1 77 0C  1mod 0 u.
    2Пример 0.
 ш1.1
   Пусть A  ═+ 0 {1,4,6,13,27}, u  ═+ 0 59, w  ═+ 0 13. Тогда w 5-1 0=50 и
 ш1.0

   A  ═+ 0 {1,4,6,13,27} => B={13,52,19,51,56}.

 ш1.1
   Алиса хочет послать сообщение M  ═+ 0 ( _1,0,0,1,1 .); она вычисляет
 ш1.0

   C=m 41 77 0b 41 0+m 42 77 0b 42 0+ 7777 0+m 4n 77 0b 4n 0=13+51+56=120.

 ш1.1
и посылает Бобу число C.
   Боб вычисляет
 ш1.0

   w 5-1 77 0C  1mod 0 u=50 77 0120  1mod 0 59=41,

 ш1.1
применяет функцию KnapSack() к числу 41 и получает переданное сооб-
щение:
 ш1.0

   41=1+13+27 => M=( _1,0,0,1,1 .).

 ш1.2
   К счастью (!),  в 1982 г.  был обнаружен  алгоритм,  позволяющий
взломать систему Меркла-Хеллмана.
   Тем не менее, если передаваемая по каналу связи информация "ста-
реет" в течение нескольких суток, то этой системой можно воспользо-
ваться.

                      3Протокол 0  3"Шарады Меркла"

 ш1.0
                        1Прогресс есть воспитание человеческого рода.
                                                             1Лессинг
 ш1.2

   Оригинальный  _ 1протокол обмена ключами . 0 был предложен  американским
криптологом Р.Мерклем ( 1R.Merkle 0,  11974 0).
   Данный протокол основывается на так называемых "шарадах",  кото-
рые требуется решить для получения ключа. Это гораздо легче сделать
отправителю и получателю шифрованных сообщений,  чем криптоаналити-
ку, перехватывающему их.
   В результате работы этого протокола Алиса  посылает  шифрованное
сообщение Бобу, предварительно не передавая ему секретного ключа:
 ш1.1
    (1) Боб генерирует 2 520 0 (около 1 миллиона) сообщений вида:
 ш1.0

    " 1Это шарада под номером х 0.  1Это секретный ключ под номером у 0",

 ш1.1
где х - случайное число, у - случайный секретный ключ.
   Пара (х,у) является уникальной для каждого сообщения.
   Затем Боб  шифрует все эти сообщения при помощи какого-либо  _ 1сим-
 _ 1метричного . 0 алгоритма на различных 20-битовых ключах и  отсылает  их
Алисе;
   (2) Алиса случайным образом выбирает одно из шифрованных сообще-
ний, присланных Бобом, и методом прямого перебора получает открытый
текст этого сообщения;
   (3) Алиса шифрует свое собственное секретное сообщение при помо-
щи другого  _ 1симметричного . 0 алгоритма на ключе у,  вскрытом им методом
прямого перебора,  и посылает это сообщение Бобу вместе с соответс-
твующим х;
   (4) Боб, зная соответствие между х и у, расшифровывает  сообще-
ние, пришедшее ему от Алисы.

 ш1.2
   Конечно же, Ева может вскрыть ключ, который был использован Али-
сой для шифрования секретного сообщения,  однако для этого Еве при-
дётся  выполнить значительно больший объём вычислений,  чем Алисе и
Бобу.
   Ева должна будет прочесть все 2 520 0 шифрованных сообщений, отправ-
ленных Бобом,  чтобы найти значение у,  соответствующее значению х,
выбранному Алисой.  На  решение  этих "шарад" Ева потратит примерно
квадрат времени.  которое потребуется Алисе и Бобу, чтобы их соста-
вить. И хотя такое отличие в трудоёмкости по криптографическим мер-
кам довольно невелико, этого может оказаться достаточно.
   Например, если  Алиса  и Боб смогут опробовать по 10000 ключей в
сек, им понадобится немногим более одной минуты,  чтобы ключ шифро-
вания у оказался в руках Алисы.
   В то же время у Евы, обладающей примерно такой же вычислительной
мощностью для  опробования ключей,  как Алиса и Боб,  на "вскрытие"
правильного ключа уйдёт больше года.
                       3Гибридные криптосистемы
   Хотя мы можем выполнять арифметические операции с очень большими
числами, на практике мы платим за это снижением  скорости  вычисле-
ний. Шифрование и расшифровка длинного сообщения, содержащего сотни
или тысячи блоков исходного текста,  могут вызвать заметные задерж-
ки.  Алгоритм RSA часто используется в  _ 1гибридных системах . 0,  которые
частично  представляют собой системы с открытым ключом и частично -
с симметричным (закрытым) ключом.
   Опишем  _ 1протокол гибридной системы . 0 для  пересылки  зашифрованного
сообщения от Алисы к Бобу (по [Кормен,2014,с.154]).
 ш1.1
    21. 0 Вначале абоненты согласуют между собой используемые системы с
открытым и закрытым ключами; например, они выбирают RSA и AES.
    22. 0 Алиса знает ключ k для криптосистемы AES и шифрует его откры-
тым RSA-ключом Алисы; результат обозначим F 4e 0(k).
    23. 0 Алиса с помощью ключа k шифрует последовательность блоков пе-
ресылаемого текста с помощью криптосистемы AES и получает блоки за-
шифрованного текста.
   Алиса пересылает Бобу F 4e 0(k) и зашифрованный текст.
    24. 0 Боб расшифровывает F 4e 0(k) путём  применения  своего  закрытого
ключа и получает ключ k=F 4d 0(F 4e 0(k)) системы AES.
   Наконец, он использует ключ  k  для  расшифровки  зашифрованного
текста с помощью AES, восстанавливая исходный текст.
   Если применяется, например,  _ 1блочный шифр с цепочками . 0 и необходим
 _ 1вектор инициализации . 0,  то его можно зашифровать как с помощью алго-
ритма RSA, так и алгоритма AES.

 ш1.2
   Напомним, что работа  1криптосистемы с закрытым ключом 0 основана на
том,  что Алиса и Боб, используют для связи  1секретный ключ 0, извест-
ный только им.  Ключ используется Алисой для  1шифрования информации 0,
а зашифрованную информацию Алиса посылает Бобу, который хочет восс-
тановить исходную информацию.
   Как именно  Алиса  зашифрует  сообщение  -  1зависит от секретного
( 1кодирующего 0) 1 ключа 0, поэтому для восстановления исходного сообщения
Боб должен знать  1декодирующий ключ 0,  чтобы обратить преобразование,
применённое Алисой.
   Простой криптосистемой  с закрытым ключом является  1шифр Вернама 0,
который называют 1 одноразовым блокнотом 0.
    3Замечание 0 [Ааронсон,2018,с.170].
 ш1.1
    _ 1Полностью гомоморфные криптосистемы . 0 - это криптосистемы с откры-
тым ключом,  которые позволяют проводить произвольные вычисления  с
зашифрованными данными вообще без их расшифровки.
   Почему это важно?  Например, для таких приложений, как "облачные
вычисления": вам  может  потребоваться  переложить какие-то длинные
вычисления с вашего мобильного устройства на некоторый внешний сер-
вер, но  так,  чтобы  не позволить этому серверу "заглянуть" в ваши
секретные данные.
   Другими словами, вы должны иметь  шифрованные выходные данные, а
сервер должен иметь возможность выполнить  сложные  вычисления  (за
которые  вы уже заплатили!),  и переслать вам обратно зашифрованные
выходные данные,  которые вы затем сможете самостоятельно расшифро-
вать (и проверить!); при этом сервер ничего о данных не узнает.
   Наконец, дополнительным бонусом является то, что никто (2013) не
знает, как их взломать даже при помощи квантового компьютера.

 ш1.2
                       3Биографические сведения
 ш1.1
    _ 1Меркле Ральф С. . 0  - американский криптограф и исследователь в об-
ласти нанотехнологий.  Является  одним  из  пионеров  асимметричной
криптографии наряду с М.Хеллманом и У.Диффи.
   Ему принадлежит открытие  _ 1головоломок Меркле . 0 (1974),  которые яв-
ляются первыми конструкциями "с открытым ключом".
 ш1.2

             2ПРИМЕРЫ РЕШЕНИЯ НЕКОТОРЫХ ТИПОВ УПРАЖНЕНИЙ
                                ...


                 2ЗАДАЧИ ДЛЯ САМОСТОЯТЕЛЬНОГО РЕШЕНИЯ
                      21. 0  3Система Диффи-Хеллмана
    21. 0 [Рябко,Фионов,2018,с.38,№2.13]
   Найдите все допустимые варианты выбора  параметра  g  в  системе
Диффи-Хеллмана при p=11.
    22. 0 (По [Рябко,Фионов,2018,с.38,№2.14])
   Вычислите закрытые  ключи  Y 4A 0,  Y 4B 0  и общий ключ Z 4AB 0 для системы
Диффи-Хеллмана с параметрами:
 ш1.1
   (а) p=23, g=5, X 4A 0=5, X 4B 0=7;  (г) p=17, g=3, X 4A 0=10, X 4B 0=5;
   (б) p=19, g=2, X 4A 0=5, X 4B 0=7;  (д) p=19, g=10, X 4A 0=4, X 4B 0=8.
   (в) p=23, g=7, X 4A 0=3, X 4B 0=4;

 ш1.2
                           22. 0  3Шифр Шамира
    21. 0 (По [Рябко,Фионов,2018,с.38,№2.15])
   Для шифра Шамира с заданными параметрами p,  c 4A 0,  c 4B 0 найдите не-
достающие параметры и опишите процесс передачи сообщения m от A к B:
 ш1.1
   (а) p=19, c 4A 0= 5, c 4B 0=7, m= 4;  (г) p=23, c 4A 0=9, c 4B 0= 3, m=17;
   (б) p=23, c 4A 0=15, c 4B 0=7, m= 6;  (д) p=17, c 4A 0=3, c 4B 0=13, m= 9.
   (в) p=19, c 4A 0=11, c 4B 0=5, m=10;

 ш1.2
                         23. 0  3Шифр Эль-Гамаля
    21. 0 (По [Рябко,Фионов,2018,с.38,№2.16])
   Для шифра Эль-Гамаля с заданными параметрами p, g, c 4B 0, k найдите
недостающие параметры  и опишите процесс передачи сообщения m поль-
зователю B:
 ш1.1
   (а) p=19, g=2, c 4B 0= 5, k= 7, m= 5;
   (б) p=23, g=5, c 4B 0= 8, k=10, m=10;
   (в) p=19, g=2, c 4B 0=11, k= 4, m=10;
   (г) p=23, g=7, c 4B 0= 3, k=15, m= 5;
   (д) p=17, g=3, c 4B 0=10, k= 5, m=10.

 ш1.2
                    24. 0  3Задачи на программирование
    21 4* 2. 0 Реализуйте с помощью  системы  символьных  вычислений  Maple
следующие протоколы:
 ш1.1
   (1) Диффи-Хеллмана для открытого распределения ключей;
   (2) шифра Шамира;
   (3) шифра Эль-Гамаля.

 ш1.2
    22. 0 Реализуйте на любом языке программирования следующий  _ 1алгоритм
 _ 1вычисления открытых ключей . p  _и . g 0 алгоритма Диффи-Хеллмана.
   Простое число p выбирается таким,  чтобы  выполнялось  равенство
p=2 77 0q+1, где q - также простое число.
   В качестве g можно выбрать любое натуральное число, для которого
справедливы неравенства 1<g<p-1, g 5q 1 mod 0 p 7- 01.
    23. 0 (По [Рябко,Фионов,2018,с.39,№2.20])
   Напишите программу на любом языке программирования,  реализующую
систему Диффи-Хеллмана.
   Рекомендуемые значения  параметров:  p=30803,  g=2,  а секретные
ключи генерировать случайным образом.
    24. 0 (По [Рябко,Фионов,2018,с.39,№2.21])
   Напишите программу на любом языке программирования,  реализующую
шифр Шамира.  Рекомендуемые значения параметров: p=30803, а осталь-
ные параметры генерировать случайным образом.
    25. 0 (По [Рябко,Фионов,2018,с.39,№2.22])
   Напишите программу на любом языке программирования,  реализующую
шифр Эль-Гамаля. Рекомендуемые значения параметров: p=30803, а зак-
рытые ключи и остальные параметры генерировать случайным образом.

    _ 1Домашнее задание . 0:
 ш1.0

   №№  21 41,2(г,д) 0 ( 13 задачи 0).

    _ 1Дополнительные задачи . 0: №№  22 41(1,2,3,4,5) 0;  24 41(1,2,3),2,3 0.
 ш1.2
